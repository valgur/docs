



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Patching sources &mdash; conan 2.0.4 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/conan-favicon.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  


  
    <link rel="stylesheet" href="../../../../_static/css/signup.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../../../../_static/css/search.css" type="text/css" />
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="conan 2.0.4 documentation" href="../../../../index.html"/>
        <link rel="up" title="tools.files" href="../files.html"/>
        <link rel="next" title="tools.meson" href="../../meson/meson.html"/>
        <link rel="prev" title="tools.files" href="../files.html"/>

 <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WK44ZFM');</script>
<!-- End Google Tag Manager -->
 



</script>


  

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html">
          

          
            
            <img src="../../../../_static/conan-docs-logo-2.svg" class="logo" />
          
          </a>

            

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../whatsnew.html">What’s new in Conan 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../integrations.html">Integrations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../conanfile.html">ConanFile methods examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../extensions.html">Conan extensions examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../tools.html">Conan recipe tools examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../cmake/cmake.html">tools.cmake</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../files.html">tools.files</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Patching sources</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../meson/meson.html">tools.meson</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autotools/autotools.html">tools.autotools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scm/git/capture_scm/git_capture_scm.html">Capturing Git scm information</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../cross_build.html">Cross-building examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../config_files.html">Configuration files examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changelog.html">Changelog</a></li>
</ul>

            
          
          <div class="dark_newsletter-div">
             <p><a href="https://conan.io/#signUp" target="_blank">Sign up for release updates</a></p>
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">conan</a>
        
      </nav>


      
      <script>
        var reldir = "../../../../index.html".replace("index.html","").replace("#", "");
      </script>
      <div class="wy-nav-content">
        <div class="rst-content">
                 
          















<div role="navigation" aria-label="breadcrumbs navigation" id="breadcrumbs">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../examples.html">Examples</a> &raquo;</li>
        
          <li><a href="../../../tools.html">Conan recipe tools examples</a> &raquo;</li>
        
          <li><a href="../files.html">tools.files</a> &raquo;</li>
        
      <li>Patching sources</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/conan-io/docs/blob/develop2/examples/tools/files/patches/patch_sources.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
</div>
          <!--<select id="search" name="state" multiple="true" onchange="window.location = reldir + this.value;" style="width:90%"></select>
          <hr/>-->
          <!--<div class="admonition important">
            <p class="admonition-title">Announcement</p>
            <p>Recipe Hacking no. 2! Building on what we learnt during the first installment we will be working on more Conan 2.0 Migration! We'll start by reviewing some open pull requests and hopefully tackle a CMake example. <a
            href=https://jfrog.zoom.us/webinar/register/WN_grFhqH0yRBeIfJmBvQoPJw> Register here to attend.</a></p>
          </div>-->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="patching-sources">
<span id="examples-tools-files-patches"></span><h1>Patching sources<a class="headerlink" href="#patching-sources" title="Permalink to this headline">¶</a></h1>
<p>In this example we are going to see how to patch the source code. This is necessary sometimes, specially when you are
creating a package for a third party library. A patch might be required in the build system scripts or even in the
source code of the library if you want, for example, to apply a security patch.</p>
<p>Please, first clone the sources to recreate this project. You can find them in the
<a class="reference external" href="https://github.com/conan-io/examples2">examples2.0 repository</a> on GitHub:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/conan-io/examples2.git
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>examples/tools/files/patches
</pre></div>
</div>
<div class="section" id="patching-using-replace-in-file">
<h2>Patching using ‘replace_in_file’<a class="headerlink" href="#patching-using-replace-in-file" title="Permalink to this headline">¶</a></h2>
<p>The simplest way to patch a file is using the <code class="docutils literal notranslate"><span class="pre">replace_in_file</span></code> tool in your recipe. It searches in a file the specified
string and replaces it with another string.</p>
<div class="section" id="in-source-method">
<h3>in source() method<a class="headerlink" href="#in-source-method" title="Permalink to this headline">¶</a></h3>
<p>The source() method is called only once for all the configurations (different calls to <strong class="command">conan create</strong> for different settings/options)
so you should patch only in the <code class="docutils literal notranslate"><span class="pre">source()</span></code> method if the changes are common for all the configurations.</p>
<p>Look at the <code class="docutils literal notranslate"><span class="pre">source()</span></code> method at the <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">conan</span> <span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span> <span class="nn">conan.tools.cmake</span> <span class="kn">import</span> <span class="n">CMakeToolchain</span><span class="p">,</span> <span class="n">CMake</span><span class="p">,</span> <span class="n">cmake_layout</span>
<span class="kn">from</span> <span class="nn">conan.tools.files</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">replace_in_file</span>


<span class="k">class</span> <span class="nc">helloRecipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>

    <span class="c1"># Binary configuration</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shared&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="s2">&quot;fPIC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]}</span>
    <span class="n">default_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shared&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;fPIC&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;https://github.com/conan-io/libhello/archive/refs/heads/main.zip&quot;</span><span class="p">,</span> <span class="n">strip_root</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">replace_in_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_folder</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;hello.cpp&quot;</span><span class="p">),</span> <span class="s2">&quot;Hello World&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello Friends!&quot;</span><span class="p">)</span>

    <span class="o">...</span>
</pre></div>
</div>
<p>We are replacing the <code class="docutils literal notranslate"><span class="pre">&quot;Hello</span> <span class="pre">World&quot;</span></code> string with “Hello Friends!”.
We can run <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span> <span class="pre">.</span></code> and verify that if the replace was done:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.
...
--------<span class="w"> </span>Testing<span class="w"> </span>the<span class="w"> </span>package:<span class="w"> </span>Running<span class="w"> </span>test<span class="o">()</span><span class="w"> </span>--------
hello/1.0:<span class="w"> </span>Hello<span class="w"> </span>Friends!<span class="w"> </span>Release!
...
</pre></div>
</div>
</div>
<div class="section" id="in-build-method">
<h3>in build() method<a class="headerlink" href="#in-build-method" title="Permalink to this headline">¶</a></h3>
<p>In this case, we need to apply a different patch depending on the configuration (<cite>self.settings</cite>, <cite>self.options</cite>…),
so it has to be done in the <code class="docutils literal notranslate"><span class="pre">build()</span></code> method. Let’s modify the recipe to introduce a change that depends on the
<code class="docutils literal notranslate"><span class="pre">self.options.shared</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">helloRecipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>

    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;https://github.com/conan-io/libhello/archive/refs/heads/main.zip&quot;</span><span class="p">,</span> <span class="n">strip_root</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">replace_in_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_folder</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;hello.cpp&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;Hello World&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Hello </span><span class="si">{}</span><span class="s2"> Friends!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Shared&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">shared</span> <span class="k">else</span> <span class="s2">&quot;Static&quot;</span><span class="p">))</span>
        <span class="n">cmake</span> <span class="o">=</span> <span class="n">CMake</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cmake</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
        <span class="n">cmake</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

    <span class="o">...</span>
</pre></div>
</div>
<p>If we call <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code> with different <code class="docutils literal notranslate"><span class="pre">option.shared</span></code> we can check the output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.
...
hello/1.0:<span class="w"> </span>Hello<span class="w"> </span>Static<span class="w"> </span>Friends!<span class="w"> </span>Release!
...

$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.<span class="w"> </span>-o<span class="w"> </span><span class="nv">shared</span><span class="o">=</span>True
...
hello/1.0:<span class="w"> </span>Hello<span class="w"> </span>Shared<span class="w"> </span>Friends!<span class="w"> </span>Debug!
...
</pre></div>
</div>
</div>
</div>
<div class="section" id="patching-using-patch-tool">
<h2>Patching using “patch” tool<a class="headerlink" href="#patching-using-patch-tool" title="Permalink to this headline">¶</a></h2>
<p>If you have a patch file (diff between two versions of a file), you can use the <code class="docutils literal notranslate"><span class="pre">conan.tools.files.patch</span></code> tool to apply it.
The rules about where to apply the patch (<code class="docutils literal notranslate"><span class="pre">source()</span></code> or <code class="docutils literal notranslate"><span class="pre">build()</span></code> methods) are the same.</p>
<p>We have this patch file, where we are changing again the message to say “Hello Patched World Release!”:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>--- a/src/hello.cpp
+++ b/src/hello.cpp
@@ -3,9 +3,9 @@

 void hello(){
     #ifdef NDEBUG
-    std::cout &lt;&lt; &quot;hello/1.0: Hello World Release!\n&quot;;
+    std::cout &lt;&lt; &quot;hello/1.0: Hello Patched World Release!\n&quot;;
     #else
-    std::cout &lt;&lt; &quot;hello/1.0: Hello World Debug!\n&quot;;
+    std::cout &lt;&lt; &quot;hello/1.0: Hello Patched World Debug!\n&quot;;
     #endif

     // ARCHITECTURES
</pre></div>
</div>
<p>Edit the <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code> to:</p>
<ol class="arabic simple">
<li>Import the <code class="docutils literal notranslate"><span class="pre">patch</span></code> tool.</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">exports_sources</span></code> to the patch file so we have it available in the cache.</li>
<li>Call the <code class="docutils literal notranslate"><span class="pre">patch</span></code> tool.</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">conan</span> <span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span> <span class="nn">conan.tools.cmake</span> <span class="kn">import</span> <span class="n">CMakeToolchain</span><span class="p">,</span> <span class="n">CMake</span><span class="p">,</span> <span class="n">cmake_layout</span>
<span class="hll"><span class="kn">from</span> <span class="nn">conan.tools.files</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">replace_in_file</span><span class="p">,</span> <span class="n">patch</span>
</span>

<span class="k">class</span> <span class="nc">helloRecipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>

    <span class="c1"># Binary configuration</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shared&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="s2">&quot;fPIC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]}</span>
    <span class="n">default_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shared&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;fPIC&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="hll">    <span class="n">exports_sources</span> <span class="o">=</span> <span class="s2">&quot;*.patch&quot;</span>
</span>
    <span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;https://github.com/conan-io/libhello/archive/refs/heads/main.zip&quot;</span><span class="p">,</span> <span class="n">strip_root</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="hll">        <span class="n">patch_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_sources_folder</span><span class="p">,</span> <span class="s2">&quot;hello_patched.patch&quot;</span><span class="p">)</span>
</span><span class="hll">        <span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch_file</span><span class="o">=</span><span class="n">patch_file</span><span class="p">)</span>
</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>We can run “conan create” and see that the patch worked:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.
...
--------<span class="w"> </span>Testing<span class="w"> </span>the<span class="w"> </span>package:<span class="w"> </span>Running<span class="w"> </span>test<span class="o">()</span><span class="w"> </span>--------
hello/1.0:<span class="w"> </span>Hello<span class="w"> </span>Patched<span class="w"> </span>World<span class="w"> </span>Release!
...
</pre></div>
</div>
<p>We can also use the <code class="docutils literal notranslate"><span class="pre">conandata.yml</span></code> <a class="reference internal" href="../../../../tutorial/creating_packages/handle_sources_in_packages.html#creating-packages-handle-sources-in-packages-conandata"><span class="std std-ref">introduced in the tutorial</span></a> so we
can declare the patches to apply for each version:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">patches</span><span class="p">:</span>
<span class="w">  </span><span class="s">&quot;1.0&quot;</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">patch_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;hello_patched.patch&quot;</span>
</pre></div>
</div>
<p>And there are the changes we introduce in the <code class="docutils literal notranslate"><span class="pre">source()</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">python</span>

    <span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;https://github.com/conan-io/libhello/archive/refs/heads/main.zip&quot;</span><span class="p">,</span> <span class="n">strip_root</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conan_data</span><span class="p">[</span><span class="s2">&quot;patches&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">:</span>
            <span class="n">patch_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_sources_folder</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;patch_file&quot;</span><span class="p">])</span>
            <span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch_file</span><span class="o">=</span><span class="n">patch_file</span><span class="p">)</span>
</pre></div>
</div>
<p>Check <a class="reference internal" href="../../../../reference/tools/files/patches.html#conan-tools-files-patch"><span class="std std-ref">patch</span></a> for more details.</p>
<p>If we run the <strong class="command">conan create</strong>, the patch is also applied:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.
...
--------<span class="w"> </span>Testing<span class="w"> </span>the<span class="w"> </span>package:<span class="w"> </span>Running<span class="w"> </span>test<span class="o">()</span><span class="w"> </span>--------
hello/1.0:<span class="w"> </span>Hello<span class="w"> </span>Patched<span class="w"> </span>World<span class="w"> </span>Release!
...
</pre></div>
</div>
</div>
<div class="section" id="patching-using-apply-conandata-patches-tool">
<h2>Patching using “apply_conandata_patches” tool<a class="headerlink" href="#patching-using-apply-conandata-patches-tool" title="Permalink to this headline">¶</a></h2>
<p>The example above works but it is a bit complex. If you follow the same yml structure (check the
<a class="reference internal" href="../../../../reference/tools/files/patches.html#conan-tools-files-apply-conandata-patches"><span class="std std-ref">apply_conandata_patches</span></a> to see the full supported yml) you
only need to call <code class="docutils literal notranslate"><span class="pre">apply_conandata_patches</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conan</span> <span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span> <span class="nn">conan.tools.cmake</span> <span class="kn">import</span> <span class="n">CMakeToolchain</span><span class="p">,</span> <span class="n">CMake</span><span class="p">,</span> <span class="n">cmake_layout</span>
<span class="kn">from</span> <span class="nn">conan.tools.files</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">apply_conandata_patches</span>


<span class="k">class</span> <span class="nc">helloRecipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>

    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;https://github.com/conan-io/libhello/archive/refs/heads/main.zip&quot;</span><span class="p">,</span> <span class="n">strip_root</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">apply_conandata_patches</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s check if the patch is also applied:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.
...
--------<span class="w"> </span>Testing<span class="w"> </span>the<span class="w"> </span>package:<span class="w"> </span>Running<span class="w"> </span>test<span class="o">()</span><span class="w"> </span>--------
hello/1.0:<span class="w"> </span>Hello<span class="w"> </span>Patched<span class="w"> </span>World<span class="w"> </span>Release!
...
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../meson/meson.html" class="btn btn-neutral float-right" title="tools.meson" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../files.html" class="btn btn-neutral" title="tools.files" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2023, JFrog.
      Last updated on Apr 17, 2023.
      <span><a href="#" class="ot-sdk-show-settings">Cookies Settings</a></span>
    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <!--<span class="fa fa-pencil-square-o"> Other versions:</span> -->
      Version: 2.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
            
                <dd><a href="/2.0/index.html">2.0</a></dd>
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
            
                <dd><a href="/2/index.html">2</a></dd>
                   
        
        <br>
        
                   
        
            
                <dd><a href="/1/index.html">1</a></dd>
                   
        
            
                <dd><a href="/en/1.59/index.html">1.59</a></dd>
                   
        
            
                <dd><a href="/en/1.58/index.html">1.58</a></dd>
                   
        
            
                <dd><a href="/en/1.57/index.html">1.57</a></dd>
                   
        
            
                <dd><a href="/en/1.56/index.html">1.56</a></dd>
                   
        
            
                <dd><a href="/en/1.55/index.html">1.55</a></dd>
                   
        
            
                <dd><a href="/en/1.54/index.html">1.54</a></dd>
                   
        
            
                <dd><a href="/en/1.53/index.html">1.53</a></dd>
                   
        
            
                <dd><a href="/en/1.52/index.html">1.52</a></dd>
                   
        
            
                <dd><a href="/en/1.51/index.html">1.51</a></dd>
                   
        
            
                <dd><a href="/en/1.50/index.html">1.50</a></dd>
                   
        
            
                <dd><a href="/en/1.49/index.html">1.49</a></dd>
                   
        
            
                <dd><a href="/en/1.48/index.html">1.48</a></dd>
                   
        
            
                <dd><a href="/en/1.47/index.html">1.47</a></dd>
                   
        
            
                <dd><a href="/en/1.46/index.html">1.46</a></dd>
                   
        
            
                <dd><a href="/en/1.45/index.html">1.45</a></dd>
                   
        
            
                <dd><a href="/en/1.44/index.html">1.44</a></dd>
                   
        
            
                <dd><a href="/en/1.43/index.html">1.43</a></dd>
                   
        
            
                <dd><a href="/en/1.42/index.html">1.42</a></dd>
                   
        
            
                <dd><a href="/en/1.41/index.html">1.41</a></dd>
                   
        
            
                <dd><a href="/en/1.40/index.html">1.40</a></dd>
                   
        
            
                <dd><a href="/en/1.39/index.html">1.39</a></dd>
                   
        
            
                <dd><a href="/en/1.38/index.html">1.38</a></dd>
                   
        
            
                <dd><a href="/en/1.37/index.html">1.37</a></dd>
                   
        
            
                <dd><a href="/en/1.36/index.html">1.36</a></dd>
                   
        
            
                <dd><a href="/en/1.35/index.html">1.35</a></dd>
                   
        
            
                <dd><a href="/en/1.34/index.html">1.34</a></dd>
                   
        
            
                <dd><a href="/en/1.33/index.html">1.33</a></dd>
                   
        
            
                <dd><a href="/en/1.32/index.html">1.32</a></dd>
                   
        
            
                <dd><a href="/en/1.31/index.html">1.31</a></dd>
                   
        
            
                <dd><a href="/en/1.30/index.html">1.30</a></dd>
                   
        
            
                <dd><a href="/en/1.29/index.html">1.29</a></dd>
                   
        
            
                <dd><a href="/en/1.28/index.html">1.28</a></dd>
                   
        
            
                <dd><a href="/en/1.27/index.html">1.27</a></dd>
                   
        
            
                <dd><a href="/en/1.26/index.html">1.26</a></dd>
                   
        
            
                <dd><a href="/en/1.25/index.html">1.25</a></dd>
                   
        
            
                <dd><a href="/en/1.24/index.html">1.24</a></dd>
                   
        
            
                <dd><a href="/en/1.23/index.html">1.23</a></dd>
                   
        
            
                <dd><a href="/en/1.22/index.html">1.22</a></dd>
                   
        
            
                <dd><a href="/en/1.21/index.html">1.21</a></dd>
                   
        
            
                <dd><a href="/en/1.20/index.html">1.20</a></dd>
                   
        
            
                <dd><a href="/en/1.19/index.html">1.19</a></dd>
                   
        
            
                <dd><a href="/en/1.18/index.html">1.18</a></dd>
                   
        
            
                <dd><a href="/en/1.17/index.html">1.17</a></dd>
                   
        
            
                <dd><a href="/en/1.16/index.html">1.16</a></dd>
                   
        
            
                <dd><a href="/en/1.15/index.html">1.15</a></dd>
                   
        
            
                <dd><a href="/en/1.14/index.html">1.14</a></dd>
                   
        
            
                <dd><a href="/en/1.13/index.html">1.13</a></dd>
                   
        
            
                <dd><a href="/en/1.12/index.html">1.12</a></dd>
                   
        
            
                <dd><a href="/en/1.11/index.html">1.11</a></dd>
                   
        
            
                <dd><a href="/en/1.10/index.html">1.10</a></dd>
                   
        
            
                <dd><a href="/en/1.9/index.html">1.9</a></dd>
                   
        
            
                <dd><a href="/en/1.8/index.html">1.8</a></dd>
                   
        
            
                <dd><a href="/en/1.7/index.html">1.7</a></dd>
                   
        
            
                <dd><a href="/en/1.6/index.html">1.6</a></dd>
                   
        
            
                <dd><a href="/en/1.5/index.html">1.5</a></dd>
                   
        
            
                <dd><a href="/en/1.4/index.html">1.4</a></dd>
                   
        
            
                <dd><a href="/en/1.3/index.html">1.3</a></dd>
                   
        
                   
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
            <dd><a href="/2.0/conan.pdf">PDF</a></dd> 
               
      </dl>
    </div>
  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'2.0.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  <!-- <script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
  <script src="../../../../_static/js/modernizr.min.js"></script>
  <script src="../../../../_static/js/search.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
-->
  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  


  <script>
    // initSearch("2.0");
  </script>

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WK44ZFM" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


 


</body>
</html>