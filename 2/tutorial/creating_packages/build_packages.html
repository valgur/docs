



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Build packages: the build() method &mdash; conan 2.0.5 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/conan-favicon.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  


  
    <link rel="stylesheet" href="../../_static/css/signup.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../../_static/css/search.css" type="text/css" />
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="conan 2.0.5 documentation" href="../../index.html"/>
        <link rel="up" title="Creating packages" href="../creating_packages.html"/>
        <link rel="next" title="Package files: the package() method" href="package_method.html"/>
        <link rel="prev" title="Configure settings and options in recipes" href="configure_options_settings.html"/>

 <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WK44ZFM');</script>
<!-- End Google Tag Manager -->
 



</script>


  

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/conan-docs-logo-2.svg" class="logo" />
          
          </a>

            

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../whatsnew.html">What’s new in Conan 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Install</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../consuming_packages.html">Consuming packages</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../creating_packages.html">Creating packages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="create_your_first_package.html">Create your first Conan package</a></li>
<li class="toctree-l3"><a class="reference internal" href="handle_sources_in_packages.html">Handle sources in packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="add_dependencies_to_packages.html">Add dependencies to packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="preparing_the_build.html">Preparing the build</a></li>
<li class="toctree-l3"><a class="reference internal" href="configure_options_settings.html">Configure settings and options in recipes</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Build packages: the build() method</a></li>
<li class="toctree-l3"><a class="reference internal" href="package_method.html">Package files: the package() method</a></li>
<li class="toctree-l3"><a class="reference internal" href="define_package_information.html">Define information for consumers: the package_info() method</a></li>
<li class="toctree-l3"><a class="reference internal" href="test_conan_packages.html">Testing Conan packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="other_types_of_packages.html">Other types of packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../conan_repositories.html">Working with Conan repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developing_packages.html">Developing packages locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="../versioning.html">Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other_features.html">Other important Conan features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

            
          
          <div class="dark_newsletter-div">
             <p><a href="https://conan.io/#signUp" target="_blank">Sign up for release updates</a></p>
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">conan</a>
        
      </nav>


      
      <script>
        var reldir = "../../index.html".replace("index.html","").replace("#", "");
      </script>
      <div class="wy-nav-content">
        <div class="rst-content">
                 
          















<div role="navigation" aria-label="breadcrumbs navigation" id="breadcrumbs">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../tutorial.html">Tutorial</a> &raquo;</li>
        
          <li><a href="../creating_packages.html">Creating packages</a> &raquo;</li>
        
      <li>Build packages: the build() method</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/conan-io/docs/blob/develop2/tutorial/creating_packages/build_packages.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
</div>
          <!--<select id="search" name="state" multiple="true" onchange="window.location = reldir + this.value;" style="width:90%"></select>
          <hr/>-->
          <!--<div class="admonition important">
            <p class="admonition-title">Announcement</p>
            <p>Recipe Hacking no. 2! Building on what we learnt during the first installment we will be working on more Conan 2.0 Migration! We'll start by reviewing some open pull requests and hopefully tackle a CMake example. <a
            href=https://jfrog.zoom.us/webinar/register/WN_grFhqH0yRBeIfJmBvQoPJw> Register here to attend.</a></p>
          </div>-->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="build-packages-the-build-method">
<span id="tutorial-creating-build"></span><h1>Build packages: the build() method<a class="headerlink" href="#build-packages-the-build-method" title="Permalink to this headline">¶</a></h1>
<p>We already used a Conan recipe that has a <a class="reference internal" href="../../reference/conanfile/methods/build.html#reference-conanfile-methods-build"><span class="std std-ref">build() method</span></a> and learned how to use that
to invoke a build system and build our packages. In this tutorial, we will modify that
method and explain how you can use it to do things like:</p>
<ul class="simple">
<li>Building and running tests</li>
<li>Conditional patching of the source code</li>
<li>Select the build system you want to use conditionally</li>
</ul>
<p>Please, first clone the sources to recreate this project. You can find them in the
<a class="reference external" href="https://github.com/conan-io/examples2">examples2.0 repository</a> on GitHub:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/conan-io/examples2.git
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>examples2/tutorial/creating_packages/build_method
</pre></div>
</div>
<div class="section" id="build-and-run-tests-for-your-project">
<h2>Build and run tests for your project<a class="headerlink" href="#build-and-run-tests-for-your-project" title="Permalink to this headline">¶</a></h2>
<p>You will notice some changes in the <strong>conanfile.py</strong> file from the previous recipe.
Let’s check the relevant parts:</p>
<div class="section" id="changes-introduced-in-the-recipe">
<h3>Changes introduced in the recipe<a class="headerlink" href="#changes-introduced-in-the-recipe" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><em>conanfile.py</em></span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">helloRecipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>

    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">git</span> <span class="o">=</span> <span class="n">Git</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">git</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://github.com/conan-io/libhello.git&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="c1"># Please, be aware that using the head of the branch instead of an immutable tag</span>
        <span class="c1"># or commit is not a good practice in general</span>
<span class="hll">        <span class="n">git</span><span class="o">.</span><span class="n">checkout</span><span class="p">(</span><span class="s2">&quot;with_tests&quot;</span><span class="p">)</span>
</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">with_fmt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;fmt/8.1.1&quot;</span><span class="p">)</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">test_requires</span><span class="p">(</span><span class="s2">&quot;gtest/1.11.0&quot;</span><span class="p">)</span>
</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tc</span> <span class="o">=</span> <span class="n">CMakeToolchain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">with_fmt</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;WITH_FMT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmake</span> <span class="o">=</span> <span class="n">CMake</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cmake</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
        <span class="n">cmake</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="hll">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tools.build:skip_test&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span class="hll">            <span class="n">test_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;tests&quot;</span><span class="p">)</span>
</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">os</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
                <span class="n">test_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;tests&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">build_type</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_folder</span><span class="p">,</span> <span class="s2">&quot;test_hello&quot;</span><span class="p">))</span>

    <span class="o">...</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li>We added the <em>gtest/1.11.0</em> requirement to the recipe as a <code class="docutils literal notranslate"><span class="pre">test_requires()</span></code>. It’s a
type of requirement intended for testing libraries like <strong>Catch2</strong> or <strong>gtest</strong>.</li>
<li>We use the <code class="docutils literal notranslate"><span class="pre">tools.build:skip_test</span></code> configuration (<code class="docutils literal notranslate"><span class="pre">False</span></code> by default), to tell CMake
whether to build and run the tests or not. A couple of things to bear in mind:<ul>
<li>If we set the <code class="docutils literal notranslate"><span class="pre">tools.build:skip_test</span></code> configuration to <code class="docutils literal notranslate"><span class="pre">True</span></code> Conan will
automatically inject the <code class="docutils literal notranslate"><span class="pre">BUILD_TESTING</span></code> variable to CMake set to <code class="docutils literal notranslate"><span class="pre">OFF</span></code>. You will
see in the next section that we are using this variable in our <em>CMakeLists.txt</em> to
decide wether to build the tests or not.</li>
<li>We use the <code class="docutils literal notranslate"><span class="pre">tools.build:skip_test</span></code> configuration in the <code class="docutils literal notranslate"><span class="pre">build()</span></code> method,
after building the package and tests, to decide if we want to run the tests or not.</li>
<li>In this case we are using <strong>gtest</strong> for testing and we have to add the check if the
build method to run the tests or not, but this configuration also affects the
execution of <code class="docutils literal notranslate"><span class="pre">CMake.test()</span></code> if you are using CTest and <code class="docutils literal notranslate"><span class="pre">Meson.test()</span></code> for Meson.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="changes-introduced-in-the-library-sources">
<h3>Changes introduced in the library sources<a class="headerlink" href="#changes-introduced-in-the-library-sources" title="Permalink to this headline">¶</a></h3>
<p>First, please note that we are using <a class="reference external" href="https://github.com/conan-io/libhello/tree/with_tests">another branch</a> from the <strong>libhello</strong> library. This
branch has two novelties on the library side:</p>
<ul class="simple">
<li>We added a new function called <code class="docutils literal notranslate"><span class="pre">compose_message()</span></code> to the <a class="reference external" href="https://github.com/conan-io/libhello/blob/with_tests/src/hello.cpp#L9-L12">library sources</a> so we can add
some unit tests over this function. This function is just creating an output message
based on the arguments passed.</li>
<li>As we mentioned in the previous section the <a class="reference external" href="https://github.com/conan-io/libhello/blob/with_tests/CMakeLists.txt#L15-L17">CMakeLists.txt for the library</a> uses the
<code class="docutils literal notranslate"><span class="pre">BUILD_TESTING</span></code> CMake variable that conditionally adds the <em>tests</em> directory.</li>
</ul>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><em>CMakeLists.txt</em></span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cmake_minimum_required(VERSION 3.15)
project(hello CXX)

...

if (NOT BUILD_TESTING STREQUAL OFF)
    add_subdirectory(tests)
endif()

...
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">BUILD_TESTING</span></code> <a class="reference external" href="https://cmake.org/cmake/help/latest/module/CTest.html">CMake variable</a> is declared and set to <code class="docutils literal notranslate"><span class="pre">OFF</span></code>
by Conan (if not already defined) whenever the <code class="docutils literal notranslate"><span class="pre">tools.build:skip_test</span></code> configuration is
set to value <code class="docutils literal notranslate"><span class="pre">True</span></code>. This variable is typically declared by CMake when you use CTest but
using the <code class="docutils literal notranslate"><span class="pre">tools.build:skip_test</span></code> configuration you can use it in your <em>CMakeListst.txt</em>
even if you are using another testing framework.</p>
<ul class="simple">
<li>We have a <a class="reference external" href="https://github.com/conan-io/libhello/blob/with_tests/tests/CMakeLists.txt">CMakeLists.txt</a> in the
<em>tests</em> folder using <a class="reference external" href="https://github.com/google/googletest">googletest</a> for
testing.</li>
</ul>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><em>tests/CMakeLists.txt</em></span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.15</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">PackageTest</span><span class="w"> </span><span class="s">CXX</span><span class="p">)</span>

<span class="nb">find_package</span><span class="p">(</span><span class="s">GTest</span><span class="w"> </span><span class="s">REQUIRED</span><span class="w"> </span><span class="s">CONFIG</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span><span class="s">test_hello</span><span class="w"> </span><span class="s">test.cpp</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">test_hello</span><span class="w"> </span><span class="s">GTest::gtest</span><span class="w"> </span><span class="s">GTest::gtest_main</span><span class="w"> </span><span class="s">hello</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>With basic tests on the functionality of the <code class="docutils literal notranslate"><span class="pre">compose_message()</span></code> function:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><em>tests/test.cpp</em></span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;../include/hello.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gtest/gtest.h&quot;</span>

<span class="k">namespace</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TEST</span><span class="p">(</span><span class="n">HelloTest</span><span class="p">,</span><span class="w"> </span><span class="n">ComposeMessages</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;hello/1.0: Hello World Release! (with color!)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">compose_message</span><span class="p">(</span><span class="s">&quot;Release&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;with color!&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Now that we have gone through all the changes in the code, let’s try them out:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.<span class="w"> </span>--build<span class="o">=</span>missing<span class="w"> </span>-tf<span class="o">=</span>None
...
<span class="o">[</span><span class="w"> </span><span class="m">25</span>%<span class="o">]</span><span class="w"> </span>Building<span class="w"> </span>CXX<span class="w"> </span>object<span class="w"> </span>CMakeFiles/hello.dir/src/hello.cpp.o
<span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span><span class="w"> </span>Linking<span class="w"> </span>CXX<span class="w"> </span>static<span class="w"> </span>library<span class="w"> </span>libhello.a
<span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span><span class="w"> </span>Built<span class="w"> </span>target<span class="w"> </span>hello
<span class="hll"><span class="o">[</span><span class="w"> </span><span class="m">75</span>%<span class="o">]</span><span class="w"> </span>Building<span class="w"> </span>CXX<span class="w"> </span>object<span class="w"> </span>tests/CMakeFiles/test_hello.dir/test.cpp.o
</span><span class="hll"><span class="o">[</span><span class="m">100</span>%<span class="o">]</span><span class="w"> </span>Linking<span class="w"> </span>CXX<span class="w"> </span>executable<span class="w"> </span>test_hello
</span><span class="hll"><span class="o">[</span><span class="m">100</span>%<span class="o">]</span><span class="w"> </span>Built<span class="w"> </span>target<span class="w"> </span>test_hello
</span><span class="hll">hello/1.0:<span class="w"> </span>RUN:<span class="w"> </span>./tests/test_hello
</span><span class="hll">Capturing<span class="w"> </span>current<span class="w"> </span>environment<span class="w"> </span><span class="k">in</span><span class="w"> </span>/Users/user/.conan2/p/tmp/c51d80ef47661865/b/build/generators/deactivate_conanbuildenv-release-x86_64.sh
</span><span class="hll">Configuring<span class="w"> </span>environment<span class="w"> </span>variables
</span><span class="hll">Running<span class="w"> </span>main<span class="o">()</span><span class="w"> </span>from<span class="w"> </span>/Users/user/.conan2/p/tmp/3ad4c6873a47059c/b/googletest/src/gtest_main.cc
</span><span class="hll"><span class="o">[==========]</span><span class="w"> </span>Running<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>from<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>suite.
</span><span class="hll"><span class="o">[</span>----------<span class="o">]</span><span class="w"> </span>Global<span class="w"> </span><span class="nb">test</span><span class="w"> </span>environment<span class="w"> </span>set-up.
</span><span class="hll"><span class="o">[</span>----------<span class="o">]</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>from<span class="w"> </span>HelloTest
</span><span class="hll"><span class="o">[</span><span class="w"> </span>RUN<span class="w">      </span><span class="o">]</span><span class="w"> </span>HelloTest.ComposeMessages
</span><span class="hll"><span class="o">[</span><span class="w">       </span>OK<span class="w"> </span><span class="o">]</span><span class="w"> </span>HelloTest.ComposeMessages<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="w"> </span>ms<span class="o">)</span>
</span><span class="hll"><span class="o">[</span>----------<span class="o">]</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>from<span class="w"> </span>HelloTest<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="w"> </span>ms<span class="w"> </span>total<span class="o">)</span>
</span><span class="hll">
</span><span class="hll"><span class="o">[</span>----------<span class="o">]</span><span class="w"> </span>Global<span class="w"> </span><span class="nb">test</span><span class="w"> </span>environment<span class="w"> </span>tear-down
</span><span class="hll"><span class="o">[==========]</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>from<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>suite<span class="w"> </span>ran.<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="w"> </span>ms<span class="w"> </span>total<span class="o">)</span>
</span><span class="hll"><span class="o">[</span><span class="w">  </span>PASSED<span class="w">  </span><span class="o">]</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>test.
</span><span class="hll">hello/1.0:<span class="w"> </span>Package<span class="w"> </span><span class="s1">&#39;82b6c0c858e739929f74f59c25c187b927d514f3&#39;</span><span class="w"> </span>built
</span>...
</pre></div>
</div>
<p>As you can see, the tests were built and run. Let’s use now the <code class="docutils literal notranslate"><span class="pre">tools.build:skip_test</span></code>
configuration in the command line to skip the test building and running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>create<span class="w"> </span>.<span class="w"> </span>-c<span class="w"> </span>tools.build:skip_test<span class="o">=</span>True<span class="w"> </span>-tf<span class="o">=</span>None
...
<span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span><span class="w"> </span>Building<span class="w"> </span>CXX<span class="w"> </span>object<span class="w"> </span>CMakeFiles/hello.dir/src/hello.cpp.o
<span class="o">[</span><span class="m">100</span>%<span class="o">]</span><span class="w"> </span>Linking<span class="w"> </span>CXX<span class="w"> </span>static<span class="w"> </span>library<span class="w"> </span>libhello.a
<span class="o">[</span><span class="m">100</span>%<span class="o">]</span><span class="w"> </span>Built<span class="w"> </span>target<span class="w"> </span>hello
hello/1.0:<span class="w"> </span>Package<span class="w"> </span><span class="s1">&#39;82b6c0c858e739929f74f59c25c187b927d514f3&#39;</span><span class="w"> </span>built
...
</pre></div>
</div>
<p>You can see now that only the library target was built and that no tests were built or
run.</p>
</div>
</div>
<div class="section" id="conditionally-patching-the-source-code">
<h2>Conditionally patching the source code<a class="headerlink" href="#conditionally-patching-the-source-code" title="Permalink to this headline">¶</a></h2>
<p>If you need to patch the source code the recommended approach is to do that in the
<code class="docutils literal notranslate"><span class="pre">source()</span></code> method. Sometimes, if that patch depends on settings or options, you have
to use the <code class="docutils literal notranslate"><span class="pre">build()</span></code> method to apply patches to the source code before launching the
build. There are <a class="reference internal" href="../../examples/tools/files/patches/patch_sources.html#examples-tools-files-patches"><span class="std std-ref">several ways to do this</span></a> in Conan.
One of them would be using the <a class="reference internal" href="../../reference/tools/files/basic.html#conan-tools-files-replace-in-file"><span class="std std-ref">replace_in_file</span></a>
tool:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">conan</span> <span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span> <span class="nn">conan.tools.files</span> <span class="kn">import</span> <span class="n">replace_in_file</span>


<span class="k">class</span> <span class="nc">helloRecipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>

    <span class="c1"># Binary configuration</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shared&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="s2">&quot;fPIC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]}</span>
    <span class="n">default_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shared&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;fPIC&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">replace_in_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_folder</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;hello.cpp&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;Hello World&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Hello </span><span class="si">{}</span><span class="s2"> Friends&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Shared&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">shared</span> <span class="k">else</span> <span class="s2">&quot;Static&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Please, note that patching in <code class="docutils literal notranslate"><span class="pre">build()</span></code> should avoided if possible and only be done for
very particular cases as it will make more difficult to develop your packages locally (we
will explain more about this in the local developement flow section later &lt;MISSING REFERENCE&gt;)</p>
</div>
<div class="section" id="conditionally-select-your-build-system">
<h2>Conditionally select your build system<a class="headerlink" href="#conditionally-select-your-build-system" title="Permalink to this headline">¶</a></h2>
<p>It’s not uncommon that some packages need one build system or another depending on the
platform we are building. For example, the <em>hello</em> library could build in Windows using
CMake and in Linux and MacOS using Autotools. This can be easily handled in the
<code class="docutils literal notranslate"><span class="pre">build()</span></code> method like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="k">class</span> <span class="nc">helloRecipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>

    <span class="c1"># Binary configuration</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shared&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="s2">&quot;fPIC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]}</span>
    <span class="n">default_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shared&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;fPIC&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">os</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
            <span class="n">tc</span> <span class="o">=</span> <span class="n">CMakeToolchain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
            <span class="n">deps</span> <span class="o">=</span> <span class="n">CMakeDeps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">deps</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tc</span> <span class="o">=</span> <span class="n">AutotoolsToolchain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
            <span class="n">deps</span> <span class="o">=</span> <span class="n">PkgConfigDeps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">deps</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>

    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">os</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
            <span class="n">cmake</span> <span class="o">=</span> <span class="n">CMake</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">cmake</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
            <span class="n">cmake</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">autotools</span> <span class="o">=</span> <span class="n">Autotools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">autotools</span><span class="o">.</span><span class="n">autoreconf</span><span class="p">()</span>
            <span class="n">autotools</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
            <span class="n">autotools</span><span class="o">.</span><span class="n">make</span><span class="p">()</span>

    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="read-more">
<h2>Read more<a class="headerlink" href="#read-more" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../../examples/tools/files/patches/patch_sources.html#examples-tools-files-patches"><span class="std std-ref">Patching sources</span></a></li>
<li>…</li>
</ul>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="package_method.html" class="btn btn-neutral float-right" title="Package files: the package() method" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configure_options_settings.html" class="btn btn-neutral" title="Configure settings and options in recipes" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2023, JFrog.
      Last updated on May 26, 2023.
      <span><a href="#" class="ot-sdk-show-settings">Cookies Settings</a></span>
    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <!--<span class="fa fa-pencil-square-o"> Other versions:</span> -->
      Version: 2.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
            
                <dd><a href="/2.0/index.html">2.0</a></dd>
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
            
                <dd><a href="/2/index.html">2</a></dd>
                   
        
        <br>
        
                   
        
            
                <dd><a href="/1/index.html">1</a></dd>
                   
        
            
                <dd><a href="/en/1.60/index.html">1.60</a></dd>
                   
        
            
                <dd><a href="/en/1.59/index.html">1.59</a></dd>
                   
        
            
                <dd><a href="/en/1.58/index.html">1.58</a></dd>
                   
        
            
                <dd><a href="/en/1.57/index.html">1.57</a></dd>
                   
        
            
                <dd><a href="/en/1.56/index.html">1.56</a></dd>
                   
        
            
                <dd><a href="/en/1.55/index.html">1.55</a></dd>
                   
        
            
                <dd><a href="/en/1.54/index.html">1.54</a></dd>
                   
        
            
                <dd><a href="/en/1.53/index.html">1.53</a></dd>
                   
        
            
                <dd><a href="/en/1.52/index.html">1.52</a></dd>
                   
        
            
                <dd><a href="/en/1.51/index.html">1.51</a></dd>
                   
        
            
                <dd><a href="/en/1.50/index.html">1.50</a></dd>
                   
        
            
                <dd><a href="/en/1.49/index.html">1.49</a></dd>
                   
        
            
                <dd><a href="/en/1.48/index.html">1.48</a></dd>
                   
        
            
                <dd><a href="/en/1.47/index.html">1.47</a></dd>
                   
        
            
                <dd><a href="/en/1.46/index.html">1.46</a></dd>
                   
        
            
                <dd><a href="/en/1.45/index.html">1.45</a></dd>
                   
        
            
                <dd><a href="/en/1.44/index.html">1.44</a></dd>
                   
        
            
                <dd><a href="/en/1.43/index.html">1.43</a></dd>
                   
        
            
                <dd><a href="/en/1.42/index.html">1.42</a></dd>
                   
        
            
                <dd><a href="/en/1.41/index.html">1.41</a></dd>
                   
        
            
                <dd><a href="/en/1.40/index.html">1.40</a></dd>
                   
        
            
                <dd><a href="/en/1.39/index.html">1.39</a></dd>
                   
        
            
                <dd><a href="/en/1.38/index.html">1.38</a></dd>
                   
        
            
                <dd><a href="/en/1.37/index.html">1.37</a></dd>
                   
        
            
                <dd><a href="/en/1.36/index.html">1.36</a></dd>
                   
        
            
                <dd><a href="/en/1.35/index.html">1.35</a></dd>
                   
        
            
                <dd><a href="/en/1.34/index.html">1.34</a></dd>
                   
        
            
                <dd><a href="/en/1.33/index.html">1.33</a></dd>
                   
        
            
                <dd><a href="/en/1.32/index.html">1.32</a></dd>
                   
        
            
                <dd><a href="/en/1.31/index.html">1.31</a></dd>
                   
        
            
                <dd><a href="/en/1.30/index.html">1.30</a></dd>
                   
        
            
                <dd><a href="/en/1.29/index.html">1.29</a></dd>
                   
        
            
                <dd><a href="/en/1.28/index.html">1.28</a></dd>
                   
        
            
                <dd><a href="/en/1.27/index.html">1.27</a></dd>
                   
        
            
                <dd><a href="/en/1.26/index.html">1.26</a></dd>
                   
        
            
                <dd><a href="/en/1.25/index.html">1.25</a></dd>
                   
        
            
                <dd><a href="/en/1.24/index.html">1.24</a></dd>
                   
        
            
                <dd><a href="/en/1.23/index.html">1.23</a></dd>
                   
        
            
                <dd><a href="/en/1.22/index.html">1.22</a></dd>
                   
        
            
                <dd><a href="/en/1.21/index.html">1.21</a></dd>
                   
        
            
                <dd><a href="/en/1.20/index.html">1.20</a></dd>
                   
        
            
                <dd><a href="/en/1.19/index.html">1.19</a></dd>
                   
        
            
                <dd><a href="/en/1.18/index.html">1.18</a></dd>
                   
        
            
                <dd><a href="/en/1.17/index.html">1.17</a></dd>
                   
        
            
                <dd><a href="/en/1.16/index.html">1.16</a></dd>
                   
        
            
                <dd><a href="/en/1.15/index.html">1.15</a></dd>
                   
        
            
                <dd><a href="/en/1.14/index.html">1.14</a></dd>
                   
        
            
                <dd><a href="/en/1.13/index.html">1.13</a></dd>
                   
        
            
                <dd><a href="/en/1.12/index.html">1.12</a></dd>
                   
        
            
                <dd><a href="/en/1.11/index.html">1.11</a></dd>
                   
        
            
                <dd><a href="/en/1.10/index.html">1.10</a></dd>
                   
        
            
                <dd><a href="/en/1.9/index.html">1.9</a></dd>
                   
        
            
                <dd><a href="/en/1.8/index.html">1.8</a></dd>
                   
        
            
                <dd><a href="/en/1.7/index.html">1.7</a></dd>
                   
        
            
                <dd><a href="/en/1.6/index.html">1.6</a></dd>
                   
        
            
                <dd><a href="/en/1.5/index.html">1.5</a></dd>
                   
        
            
                <dd><a href="/en/1.4/index.html">1.4</a></dd>
                   
        
            
                <dd><a href="/en/1.3/index.html">1.3</a></dd>
                   
        
                   
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
            <dd><a href="/2.0/conan.pdf">PDF</a></dd> 
               
      </dl>
    </div>
  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.0.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  <!-- <script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
  <script src="../../_static/js/modernizr.min.js"></script>
  <script src="../../_static/js/search.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
-->
  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  


  <script>
    // initSearch("2.0");
  </script>

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WK44ZFM" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


 


</body>
</html>