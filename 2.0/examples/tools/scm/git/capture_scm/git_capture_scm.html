



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Capturing Git scm information &mdash; conan 2.0.4 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../../_static/conan-favicon.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  


  
    <link rel="stylesheet" href="../../../../../_static/css/signup.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../../../../../_static/css/search.css" type="text/css" />
        <link rel="index" title="Index"
              href="../../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../../search.html"/>
    <link rel="top" title="conan 2.0.4 documentation" href="../../../../../index.html"/>
        <link rel="up" title="Conan recipe tools examples" href="../../../../tools.html"/>
        <link rel="next" title="Cross-building examples" href="../../../../cross_build.html"/>
        <link rel="prev" title="Build a simple Meson project using Conan" href="../../../meson/mesontoolchain/build_simple_meson_project.html"/>

 <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WK44ZFM');</script>
<!-- End Google Tag Manager -->
 



</script>


  

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../index.html">
          

          
            
            <img src="../../../../../_static/conan-docs-logo-2.svg" class="logo" />
          
          </a>

            

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../whatsnew.html">What’s new in Conan 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integrations.html">Integrations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../conanfile.html">ConanFile methods examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../extensions.html">Conan extensions examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../tools.html">Conan recipe tools examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../cmake/cmake.html">tools.cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../files/files.html">tools.files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../meson/meson.html">tools.meson</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Capturing Git scm information</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../cross_build.html">Cross-building examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../config_files.html">Configuration files examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../changelog.html">Changelog</a></li>
</ul>

            
          
          <div class="dark_newsletter-div">
             <p><a href="https://conan.io/#signUp" target="_blank">Sign up for release updates</a></p>
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">conan</a>
        
      </nav>


      
      <script>
        var reldir = "../../../../../index.html".replace("index.html","").replace("#", "");
      </script>
      <div class="wy-nav-content">
        <div class="rst-content">
                 
          















<div role="navigation" aria-label="breadcrumbs navigation" id="breadcrumbs">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../../examples.html">Examples</a> &raquo;</li>
        
          <li><a href="../../../../tools.html">Conan recipe tools examples</a> &raquo;</li>
        
      <li>Capturing Git scm information</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/conan-io/docs/blob/develop2/examples/tools/scm/git/capture_scm/git_capture_scm.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
</div>
          <!--<select id="search" name="state" multiple="true" onchange="window.location = reldir + this.value;" style="width:90%"></select>
          <hr/>-->
          <!--<div class="admonition important">
            <p class="admonition-title">Announcement</p>
            <p>Recipe Hacking no. 2! Building on what we learnt during the first installment we will be working on more Conan 2.0 Migration! We'll start by reviewing some open pull requests and hopefully tackle a CMake example. <a
            href=https://jfrog.zoom.us/webinar/register/WN_grFhqH0yRBeIfJmBvQoPJw> Register here to attend.</a></p>
          </div>-->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="capturing-git-scm-information">
<span id="examples-tools-scm-git-capture"></span><h1>Capturing Git scm information<a class="headerlink" href="#capturing-git-scm-information" title="Permalink to this headline">¶</a></h1>
<p>There are 2 main strategies to handle source code in recipes:</p>
<ul class="simple">
<li><strong>Third-party code</strong>: When the <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code> recipe is packaging third party code, like an open source library, it is typically better to use the <code class="docutils literal notranslate"><span class="pre">source()</span></code> method to download or clone the sources of that library. This is the approach followed by the <code class="docutils literal notranslate"><span class="pre">conan-center-index</span></code> repository for ConanCenter.</li>
<li><strong>Your own code</strong>: When the <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code> recipe is packaging your own code, it is typically better to have the <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code> in the same repository as the sources. Then, there are 2 alternatives for achieving reproducibility:<ul>
<li>Using the <code class="docutils literal notranslate"><span class="pre">exports_sources</span></code> (or <code class="docutils literal notranslate"><span class="pre">export_source()</span></code> method) to capture a copy of the sources together with the recipe in the Conan package. This is very simple and pragmatic and would be recommended for the majority of cases.</li>
<li>For cases when it is not possible to store the sources beside the Conan recipe, for example when the package is to be consumed for someone that shouldn’t have access to the source code at all, then the current <strong>scm capture</strong> method would be the way.</li>
</ul>
</li>
</ul>
<p>In the <strong>scm capture</strong> method, instead of capturing a copy of the code itself, the “coordinates” for that code are captured instead, in the <code class="docutils literal notranslate"><span class="pre">Git</span></code> case, the <code class="docutils literal notranslate"><span class="pre">url</span></code> of the repository and the <code class="docutils literal notranslate"><span class="pre">commit</span></code>. If the recipe needs to build from source, it will use that information to get a clone, and if the user who tries that is not authorized, the process will fail. They will still be able to use the pre-compiled binaries that we distribute, but not build from source or have access to the code.</p>
<p>Let’s see how it works with an example. Please, first clone the sources to recreate this project. You can find them in the
<a class="reference external" href="https://github.com/conan-io/examples2">examples2.0 repository</a> on GitHub:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/conan-io/examples2.git
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>examples2/examples/tools/scm/git/capture_scm
</pre></div>
</div>
<p>There we will find a small “hello” project, containing this <code class="docutils literal notranslate"><span class="pre">conanfile.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conan</span> <span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span> <span class="nn">conan.tools.cmake</span> <span class="kn">import</span> <span class="n">CMake</span><span class="p">,</span> <span class="n">cmake_layout</span>
<span class="kn">from</span> <span class="nn">conan.tools.scm</span> <span class="kn">import</span> <span class="n">Git</span>
<span class="kn">from</span> <span class="nn">conan.tools.files</span> <span class="kn">import</span> <span class="n">load</span><span class="p">,</span> <span class="n">update_conandata</span>


<span class="k">class</span> <span class="nc">helloRecipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>

    <span class="c1"># Binary configuration</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shared&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="s2">&quot;fPIC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]}</span>
    <span class="n">default_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shared&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;fPIC&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="n">generators</span> <span class="o">=</span> <span class="s2">&quot;CMakeDeps&quot;</span><span class="p">,</span> <span class="s2">&quot;CMakeToolchain&quot;</span>

    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">git</span> <span class="o">=</span> <span class="n">Git</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipe_folder</span><span class="p">)</span>
        <span class="n">scm_url</span><span class="p">,</span> <span class="n">scm_commit</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">get_url_and_commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Obtained URL: </span><span class="si">{</span><span class="n">scm_url</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">scm_commit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># we store the current url and commit in conandata.yml</span>
        <span class="n">update_conandata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;sources&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;commit&quot;</span><span class="p">:</span> <span class="n">scm_commit</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">scm_url</span><span class="p">}})</span>

    <span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># we recover the saved url and commit from conandata.yml and use them to get sources</span>
        <span class="n">git</span> <span class="o">=</span> <span class="n">Git</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conan_data</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cloning sources from: </span><span class="si">{</span><span class="n">sources</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">git</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">sources</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">git</span><span class="o">.</span><span class="n">checkout</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="n">sources</span><span class="p">[</span><span class="s2">&quot;commit&quot;</span><span class="p">])</span>

    <span class="o">...</span>
</pre></div>
</div>
<p>We need this code to be in its own Git repository, to see how it works in the real case, so
please create a folder outside of the <code class="docutils literal notranslate"><span class="pre">examples2</span></code> repository, and copy the contents of the current folder there, then:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ mkdir /home/myuser/myfolder # or equivalent in other OS
$ cp -R . /home/myuser/myfolder # or equivalent in other OS
$ cd /home/myuser/myfolder # or equivalent in other OS

# Initialize the git repo
$ git init .
$ git add .
$ git commit . -m wip
# Finally create the package
$ conan create .
...
hello/0.1: WARN: Current commit 8e8764c40bebabbe3ec57f9a0816a2c8e691f559 doesn&#39;t exist in remote origin
This revision will not be buildable in other computer
hello/0.1: Obtained URL: &lt;local-path&gt;/capture_scm and 8e8764c40bebabbe3ec57f9a0816a2c8e691f559
hello/0.1: Copied 1 &#39;.yml&#39; file: conandata.yml
hello/0.1: Copied 1 &#39;.py&#39; file: conanfile.py
...
hello/0.1: Cloning sources from: {&#39;commit&#39;: &#39;8e8764c40bebabbe3ec57f9a0816a2c8e691f559&#39;, &#39;url&#39;: &#39;&lt;local-path&gt;/capture_scm&#39;}
</pre></div>
</div>
<p>Let’s explain step by step what is happening:</p>
<ul class="simple">
<li>When the recipe is exported to the Conan cache, the <code class="docutils literal notranslate"><span class="pre">export()</span></code> method executes, running <code class="docutils literal notranslate"><span class="pre">scm_url,</span> <span class="pre">scm_commit</span> <span class="pre">=</span> <span class="pre">git.get_url_and_commit()</span></code>. See the <a class="reference internal" href="../../../../../reference/tools/scm/git.html#conan-tools-scm-git"><span class="std std-ref">Git reference</span></a> for more information about these methods.</li>
<li>This obtains the URL of the repo pointing to the local <code class="docutils literal notranslate"><span class="pre">&lt;local-path&gt;/capture_scm</span></code> and the commit <code class="docutils literal notranslate"><span class="pre">8e8764c40bebabbe3ec57f9a0816a2c8e691f559</span></code></li>
<li>It warns that this information will <strong>not</strong> be enough to re-build from source this recipe once the package is uploaded to the server and is tried to be built from source in other computer, which will not contain the path pointed by <code class="docutils literal notranslate"><span class="pre">&lt;local-path&gt;/capture_scm</span></code>. This is expected, as the repository that we created doesn’t have any remote defined. If our local clone had a remote defined and that remote contained the <code class="docutils literal notranslate"><span class="pre">commit</span></code> that we are building, the <code class="docutils literal notranslate"><span class="pre">scm_url</span></code> would point to the remote repository instead, making the build from source fully reproducible.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">export()</span></code> method stores the <code class="docutils literal notranslate"><span class="pre">url</span></code> and <code class="docutils literal notranslate"><span class="pre">commit</span></code> information in the <code class="docutils literal notranslate"><span class="pre">conandata.yml</span></code> for future reproducibility.</li>
<li>When the package needs to be built from sources and it calls the <code class="docutils literal notranslate"><span class="pre">source()</span></code> method, it recovers the information from the <code class="docutils literal notranslate"><span class="pre">conandata.yml</span></code> file, and calls <code class="docutils literal notranslate"><span class="pre">git.clone()</span></code> with it to retrive the sources. In this case, it will be cloning from the local checkout in <code class="docutils literal notranslate"><span class="pre">&lt;local-path&gt;/capture_scm</span></code>, but if it had a remote defined, it will clone from it.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">To achieve reproducibility, it is very important for this <strong>scm capture</strong> technique that the current checkout is not dirty. If it was dirty, it would be impossible to guarantee future reproducibility of the build, so <code class="docutils literal notranslate"><span class="pre">git.get_url_and_commit()</span></code> can raise errors, and require to commit changes. If more than 1 commit is necessary, it would be recommended to squash those commits before pushing changes to upstream repositories.</p>
</div>
<p>If we do now a second <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span> <span class="pre">.</span></code>, as the repo is dirty we would get:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ conan create .
hello/0.1: Calling export()
ERROR: hello/0.1: Error in export() method, line 19
    scm_url, scm_commit = git.get_url_and_commit()
    ConanException: Repo is dirty, cannot capture url and commit: .../capture_scm
</pre></div>
</div>
<p>This could be solved by cleaning the repo with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clean</span> <span class="pre">-xdf</span></code>, or by adding a <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file to the repo with the following contents
(which might be a good practice anyway for source control):</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">.gitignore</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>test_package/build
test_package/CMakeUserPresets.json
</pre></div>
</div>
</div>
<div class="section" id="credentials-management">
<h2>Credentials management<a class="headerlink" href="#credentials-management" title="Permalink to this headline">¶</a></h2>
<p>In the example above, credentials were not necessary, because our local repo didn’t require them. But in real world scenarios, the credentials can be required.</p>
<p>The first important bit is that <code class="docutils literal notranslate"><span class="pre">git.get_url_and_commit()</span></code> will capture the url of the <code class="docutils literal notranslate"><span class="pre">origin</span></code> remote. This url must not encode tokens, users or passwords, for several reasons. First because that will make the process not repeatable, and different builds, different users would get different urls, and consequently different recipe revisions. The <code class="docutils literal notranslate"><span class="pre">url</span></code> should always be the same. The recommended approach is to manage the credentials in an orthogonal way, for example using ssh keys. The provided example contains a Github action that does this:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">.github/workflows/hello-demo.yml</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build &quot;hello&quot; package capturing SCM in Github actions</span>
<span class="nt">run-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.actor }} checking hello-ci Git scm capture</span>
<span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">push</span><span class="p p-Indicator">]</span>
<span class="nt">jobs</span><span class="p">:</span>
<span class="nt">Build</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check out repository code</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">uses</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">with</span><span class="p p-Indicator">:</span>
<span class="w">        </span><span class="nt">ssh-key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SSH_PRIVATE_KEY }}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v4</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">with</span><span class="p p-Indicator">:</span>
<span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.10&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webfactory/ssh-agent@v0.7.0</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">with</span><span class="p p-Indicator">:</span>
<span class="w">        </span><span class="nt">ssh-private-key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SSH_PRIVATE_KEY }}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install conan</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conan profile detect</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conan create .</span>
</pre></div>
</div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">hello-demo.yml</span></code> takes care of the following:</p>
<ul class="simple">
<li>The checkout <code class="docutils literal notranslate"><span class="pre">actions/checkout&#64;v3</span></code> action receives the <code class="docutils literal notranslate"><span class="pre">ssh-key</span></code> to checkout as <code class="docutils literal notranslate"><span class="pre">git&#64;</span></code> instead of <code class="docutils literal notranslate"><span class="pre">https</span></code></li>
<li>The <code class="docutils literal notranslate"><span class="pre">webfactory/ssh-agent&#64;v0.7.0</span></code> action takes care that the ssh key is also activated during the execution of the following tasks, not only during the checkout.</li>
<li>It is necessary to setup the <code class="docutils literal notranslate"><span class="pre">SSH_PRIVATE_KEY</span></code> secret in the Github interface, as well as the <code class="docutils literal notranslate"><span class="pre">deploy</span> <span class="pre">key</span></code> for the repo (with the private and public parts of the ssh-key)</li>
</ul>
<p>In this way, it is possible to keep completely separated the authentication and credentials from the recipe functionality, without any risk to leaking credentials.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Best practices</strong></p>
<ul class="last simple">
<li>Do not use an authentication mechanism that encodes information in the urls. This is risky, can easily disclose credentials in logs. It is recommended to use system mechanisms like ssh keys.</li>
<li>Doing <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code> is not recommended for local development, but instead running <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">install</span></code> and building locally, to avoid too many unnecessary commits. Only when everything works locally, it is time to start checking the <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">create</span></code> flow.</li>
</ul>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../../../cross_build.html" class="btn btn-neutral float-right" title="Cross-building examples" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../../meson/mesontoolchain/build_simple_meson_project.html" class="btn btn-neutral" title="Build a simple Meson project using Conan" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2023, JFrog.
      Last updated on Apr 11, 2023.
      <span><a href="#" class="ot-sdk-show-settings">Cookies Settings</a></span>
    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <!--<span class="fa fa-pencil-square-o"> Other versions:</span> -->
      Version: 2.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
            
                <dd><a href="/2.0/index.html">2.0</a></dd>
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
            
                <dd><a href="/2/index.html">2</a></dd>
                   
        
        <br>
        
                   
        
            
                <dd><a href="/1/index.html">1</a></dd>
                   
        
            
                <dd><a href="/en/1.59/index.html">1.59</a></dd>
                   
        
            
                <dd><a href="/en/1.58/index.html">1.58</a></dd>
                   
        
            
                <dd><a href="/en/1.57/index.html">1.57</a></dd>
                   
        
            
                <dd><a href="/en/1.56/index.html">1.56</a></dd>
                   
        
            
                <dd><a href="/en/1.55/index.html">1.55</a></dd>
                   
        
            
                <dd><a href="/en/1.54/index.html">1.54</a></dd>
                   
        
            
                <dd><a href="/en/1.53/index.html">1.53</a></dd>
                   
        
            
                <dd><a href="/en/1.52/index.html">1.52</a></dd>
                   
        
            
                <dd><a href="/en/1.51/index.html">1.51</a></dd>
                   
        
            
                <dd><a href="/en/1.50/index.html">1.50</a></dd>
                   
        
            
                <dd><a href="/en/1.49/index.html">1.49</a></dd>
                   
        
            
                <dd><a href="/en/1.48/index.html">1.48</a></dd>
                   
        
            
                <dd><a href="/en/1.47/index.html">1.47</a></dd>
                   
        
            
                <dd><a href="/en/1.46/index.html">1.46</a></dd>
                   
        
            
                <dd><a href="/en/1.45/index.html">1.45</a></dd>
                   
        
            
                <dd><a href="/en/1.44/index.html">1.44</a></dd>
                   
        
            
                <dd><a href="/en/1.43/index.html">1.43</a></dd>
                   
        
            
                <dd><a href="/en/1.42/index.html">1.42</a></dd>
                   
        
            
                <dd><a href="/en/1.41/index.html">1.41</a></dd>
                   
        
            
                <dd><a href="/en/1.40/index.html">1.40</a></dd>
                   
        
            
                <dd><a href="/en/1.39/index.html">1.39</a></dd>
                   
        
            
                <dd><a href="/en/1.38/index.html">1.38</a></dd>
                   
        
            
                <dd><a href="/en/1.37/index.html">1.37</a></dd>
                   
        
            
                <dd><a href="/en/1.36/index.html">1.36</a></dd>
                   
        
            
                <dd><a href="/en/1.35/index.html">1.35</a></dd>
                   
        
            
                <dd><a href="/en/1.34/index.html">1.34</a></dd>
                   
        
            
                <dd><a href="/en/1.33/index.html">1.33</a></dd>
                   
        
            
                <dd><a href="/en/1.32/index.html">1.32</a></dd>
                   
        
            
                <dd><a href="/en/1.31/index.html">1.31</a></dd>
                   
        
            
                <dd><a href="/en/1.30/index.html">1.30</a></dd>
                   
        
            
                <dd><a href="/en/1.29/index.html">1.29</a></dd>
                   
        
            
                <dd><a href="/en/1.28/index.html">1.28</a></dd>
                   
        
            
                <dd><a href="/en/1.27/index.html">1.27</a></dd>
                   
        
            
                <dd><a href="/en/1.26/index.html">1.26</a></dd>
                   
        
            
                <dd><a href="/en/1.25/index.html">1.25</a></dd>
                   
        
            
                <dd><a href="/en/1.24/index.html">1.24</a></dd>
                   
        
            
                <dd><a href="/en/1.23/index.html">1.23</a></dd>
                   
        
            
                <dd><a href="/en/1.22/index.html">1.22</a></dd>
                   
        
            
                <dd><a href="/en/1.21/index.html">1.21</a></dd>
                   
        
            
                <dd><a href="/en/1.20/index.html">1.20</a></dd>
                   
        
            
                <dd><a href="/en/1.19/index.html">1.19</a></dd>
                   
        
            
                <dd><a href="/en/1.18/index.html">1.18</a></dd>
                   
        
            
                <dd><a href="/en/1.17/index.html">1.17</a></dd>
                   
        
            
                <dd><a href="/en/1.16/index.html">1.16</a></dd>
                   
        
            
                <dd><a href="/en/1.15/index.html">1.15</a></dd>
                   
        
            
                <dd><a href="/en/1.14/index.html">1.14</a></dd>
                   
        
            
                <dd><a href="/en/1.13/index.html">1.13</a></dd>
                   
        
            
                <dd><a href="/en/1.12/index.html">1.12</a></dd>
                   
        
            
                <dd><a href="/en/1.11/index.html">1.11</a></dd>
                   
        
            
                <dd><a href="/en/1.10/index.html">1.10</a></dd>
                   
        
            
                <dd><a href="/en/1.9/index.html">1.9</a></dd>
                   
        
            
                <dd><a href="/en/1.8/index.html">1.8</a></dd>
                   
        
            
                <dd><a href="/en/1.7/index.html">1.7</a></dd>
                   
        
            
                <dd><a href="/en/1.6/index.html">1.6</a></dd>
                   
        
            
                <dd><a href="/en/1.5/index.html">1.5</a></dd>
                   
        
            
                <dd><a href="/en/1.4/index.html">1.4</a></dd>
                   
        
            
                <dd><a href="/en/1.3/index.html">1.3</a></dd>
                   
        
                   
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
            <dd><a href="/2.0/conan.pdf">PDF</a></dd> 
               
      </dl>
    </div>
  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../',
            VERSION:'2.0.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>
  

  <!-- <script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
  <script src="../../../../../_static/js/modernizr.min.js"></script>
  <script src="../../../../../_static/js/search.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
-->
  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  


  <script>
    // initSearch("2.0");
  </script>

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WK44ZFM" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


 


</body>
</html>